{% load static %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Contact - Brandise Box</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link rel="icon" href="/media/logo/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'css/contact.css' %}">
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    <style>
        .quicksand{
            font-family: 'Quicksand', sans-serif;
        }
    </style>
</head>
<body>
    {% include 'partials/nav.html' %}
    {% include 'partials/nx_header.html' %}
    <main class="contact-root">
        <section class="contact-hero">
            <h1 class="contact-title">
                <span class="fade">Say Hi! <span style="color:black;">and tell</span><br></span>
                <span class="main">us about your<br>idea</span>
            </h1>
            <p class="contact-sub">Have a nice works? Reach out and let's chat.</p>
        </section>

        <section class="contact-form-section">
            <form class="contact-form" id="contactForm" action="#" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="field-group">
                    <label class="label">Name<span class="req">*</span></label>
                    <input type="text" name="name" class="input" placeholder="Hello..." required>
                </div>
                <div class="field-group">
                    <label class="label">Email<span class="req">*</span></label>
                    <input type="email" name="email" class="input" placeholder="Where can we reply?" required>
                </div>
                <div class="field-group">
                    <label class="label">
                        Mobile Number<span class="req">*</span></label>
                    <input type="tel" name="phone" class="input" placeholder="Your mobile number?" pattern="[0-9]{10}" title="Please enter a valid 10-digit mobile number" maxlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required>
                </div>

                <div class="field-group" style="padding-bottom: 24px;">
                    <label style="margin-bottom: 14px;" class="label">What's in your mind?<span class="req">*</span>    </label>
                    <div class="chips" id="topicChips" role="group" aria-label="Project type">
                        <button type="button" class="chip is-selected">Web App</button>
                        <button type="button" class="chip">Website Design</button>
                        <button type="button" class="chip">Consultancy</button>
                        <button type="button" class="chip">Brand Development</button>
                        <button type="button" class="chip">Concept Designing</button>
                        <button type="button" class="chip">Growth Intelligence</button>
                        <button type="button" class="chip">Career</button>
                    </div>
                </div>

                <div class="field-group" id="resumeFieldGroup" style="display:none; padding-bottom: 24px;">
                    <label class="label">Upload your resume<span class="req">*</span></label>
                    <input type="file" name="resume" id="resumeInput" class="input" accept=".pdf,.doc,.docx,.rtf,.txt">
                </div>

                <div class="field-group">
                    <label class="label">Message<span class="req">*</span></label>
                    <textarea name="message" class="textarea" placeholder="I want to build some..." required></textarea>
                </div>

                <div class="form-footer">
                    <button type="submit" id="submitBtn" class="submit-btn">Submit <span aria-hidden>→</span></button>
                </div>
            </form>
            <div id="formAlert" style="display:none;margin-top:12px;font-family:Inter,system-ui,-apple-system,sans-serif;font-size:14px;"></div>
        </section>
    </main>

    <script>
    // Simple chip selection logic (no framework) + resume toggle
    const resumeFieldGroup = document.getElementById('resumeFieldGroup');
    const resumeInput = document.getElementById('resumeInput');

    function isCareerSelected(){
        return Array.from(topicChips.querySelectorAll('.chip.is-selected')).some(b => b.textContent.trim() === 'Career');
    }

    function updateResumeVisibility(){
        const show = isCareerSelected();
        resumeFieldGroup.style.display = show ? 'block' : 'none';
        if(resumeInput){
            resumeInput.required = show;
            if(!show){ resumeInput.value = ''; }
        }
    }

    document.addEventListener('click', function(e){
        if(e.target.classList.contains('chip')){
            e.target.classList.toggle('is-selected');
            updateResumeVisibility();
        }
    });
    
    // AJAX form submission (no reload)
    const form = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const topicChips = document.getElementById('topicChips');
    const formAlert = document.getElementById('formAlert');

    function setAlert(type, text){
        formAlert.style.display = 'block';
        formAlert.style.padding = '10px 12px';
        formAlert.style.borderRadius = '10px';
        formAlert.style.border = '1px solid ' + (type === 'success' ? '#DCFCE7' : '#FEE2E2');
        formAlert.style.background = type === 'success' ? '#F0FDF4' : '#FEF2F2';
        formAlert.style.color = type === 'success' ? '#166534' : '#991B1B';
        formAlert.textContent = text;
    }

    function getCookie(name){
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    form.addEventListener('submit', async function(e){
        e.preventDefault();
        setAlert('', '');
        formAlert.style.display = 'none';

        const name = form.querySelector('input[name="name"]').value.trim();
        const email = form.querySelector('input[name="email"]').value.trim();
        const phone = form.querySelector('input[name="phone"]').value.trim();
        const message = form.querySelector('textarea[name="message"]').value.trim();
        const topics = Array.from(topicChips.querySelectorAll('.chip.is-selected')).map(b => b.textContent.trim());
        const careerSelected = topics.includes('Career');

        if(careerSelected && (!resumeInput || resumeInput.files.length === 0)){
            setAlert('error', 'Please upload your resume.');
            return;
        }

        submitBtn.disabled = true;
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = 'Sending…';

        try{
            const formData = new FormData();
            formData.append('name', name);
            formData.append('email', email);
            formData.append('phone', phone);
            formData.append('message', message);
            formData.append('topics', JSON.stringify(topics));
            if(resumeInput && resumeInput.files.length > 0){
                formData.append('resume', resumeInput.files[0]);
            }

            const res = await fetch('/api/contact/submit/', {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': getCookie('csrftoken') || ''
                },
                body: formData
            });
            const data = await res.json();
            if(!res.ok || !data.ok){
                throw new Error(data.message || 'Something went wrong.');
            }
            setAlert('success', data.message || 'Sent!');
            form.reset();
            topicChips.querySelectorAll('.chip.is-selected').forEach(c => c.classList.remove('is-selected'));
            updateResumeVisibility();
        }catch(err){
            setAlert('error', err.message || 'Failed to send. Please try again.');
        }finally{
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    });
    // Initialize hidden state on load
    updateResumeVisibility();
    </script>
</body>
</html>


