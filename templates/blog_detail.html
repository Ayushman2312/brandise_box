{% load static %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ blog.title }} â€” Blog</title>
    <link rel="icon" href="/media/logo/favicon.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/blog_detail.css' %}?v={% now 'U' %}">
</head>
<body>
    <main class="bd-root">
        <section class="bd-split">
            <div class="bd-left" aria-hidden="true">
                {% if blog.cover_image %}
                <img src="{{ blog.cover_image.url }}" alt="{{ blog.title }} cover">
                {% else %}
                <img src="https://images.unsplash.com/photo-1511499767150-a48a237f0083?q=80&w=1200&auto=format&fit=crop" alt="cover placeholder">
                {% endif %}
            </div>

            <article class="bd-right">
                <header class="bd-header">
                    <p class="bd-kicker">Journal</p>
                    <h1 class="bd-title">{{ blog.title }}</h1>
                    <button id="bd-share-btn" class="bd-share-btn" type="button" aria-label="Share this post" title="Share">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <path d="M18 8a3 3 0 1 0-2.816-4H15a3 3 0 0 0 .184 1.036L8.91 8.12a3 3 0 0 0-1.82-.62 3 3 0 1 0 2.816 4H10a3 3 0 0 0-.184-1.036l6.274-3.084c.519.548 1.249.9 2.05.9Z" fill="currentColor"/>
                            <path d="M18 16a3 3 0 0 0-2.05.9l-6.274-3.084A3 3 0 0 0 10 12h-.094A3 3 0 1 0 8.09 16.5c.68 0 1.3-.227 1.82-.62L16.184 19A3 3 0 1 0 18 16Z" fill="currentColor"/>
                        </svg>
                    </button>
                    <span id="bd-share-toast" class="bd-share-toast" aria-live="polite" role="status"></span>
                </header>

                <div class="bd-content" id="bd-content">
                    {% if first_paragraph %}
                    <p class="bd-lede" data-lede>{{ first_paragraph }}</p>
                    {% endif %}
                    {% for para in rest_paragraphs %}
                    <p style="font-size: 14px;">{{ para }}</p>
                    {% endfor %}
                </div>
            </article>
        </section>
    </main>

    <script>
    // Enhance the first letter of the first paragraph as a drop cap
    (function(){
        const lede = document.querySelector('.bd-lede');
        if(!lede) return;
        const text = lede.textContent || '';
        if(!text.trim()) return;
        const firstChar = text.trim().charAt(0);
        // Wrap first letter only once; keep rest intact
        const idx = text.indexOf(firstChar);
        lede.innerHTML = `<span class="bd-drop">${firstChar}</span>` + text.slice(idx+1);
    })();
    (function(){
        const btn = document.getElementById('bd-share-btn');
        const toast = document.getElementById('bd-share-toast');
        if(!btn) return;
        const isMobile = window.matchMedia('(max-width: 480px)').matches;
        if(!isMobile) return;
        btn.addEventListener('click', async function(){
            const url = window.location.href;
            try{
                if(navigator.share){
                    await navigator.share({title: document.title, url});
                    toast.textContent = 'Link shared';
                }else if(navigator.clipboard && window.isSecureContext){
                    await navigator.clipboard.writeText(url);
                    toast.textContent = 'Link copied';
                }else{
                    const tmp = document.createElement('input');
                    tmp.value = url;
                    document.body.appendChild(tmp);
                    tmp.select();
                    document.execCommand('copy');
                    document.body.removeChild(tmp);
                    toast.textContent = 'Link copied';
                }
            }catch(e){
                toast.textContent = 'Could not share';
            }
            toast.style.opacity = '1';
            clearTimeout(window.__bdShareTimer);
            window.__bdShareTimer = setTimeout(()=>{ toast.style.opacity = '0'; }, 1600);
        });
    })();
    </script>
</body>
</html>


